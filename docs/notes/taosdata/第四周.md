# 日记

## 仪表板改动

- 为满足用户`快速浏览`各元素的仪表板配置情况，对仪表板做了一些改动
- 点击`元素` -> `仪表板`
- 点击`预览`按钮，支持以卡片形式查看仪表板
- 点击`仪表板名称`下拉菜单，可切换仪表板展示
- 点击左侧树中的元素节点，可切换不同元素的仪表板展示，`仪表板名称`默认选择第一个

- 实现方式

```bash
# 在pinia中创建一个对象用于传递（共享）浏览仪表板的状态参数 & 下拉选择菜单，实现元素/仪表板切换保持浏览状态功能
```

## 调整面板、仪表板条目顺序

- 面板分为：普通面板、面板模板
- 两种面板的显示顺序分开来做
  - 第一个普通面板、第一个面板模板`没有上移`
  - 最后一个普通面板、最后一个面板模板`没有下移`
  - 过滤条件不影响调整顺序，直接交换
    - 若两个显示顺序字段都为空，设置`0、1`
    - 若一个显示顺序字段为空，按已有显示顺序`+_1`
    - 若都有值，直接交换

## 面板卡片添加拖拽排序逻辑

- sortablejs

## bar-gauge

- No.1

```js
var xData = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
var data = [10, 90, 50, 80, 70, 80, 30]
var [dataMin, dataMax] = [0, 100]
var baseRule = [{ value: undefined, color: '#06b0eeff' }]
var rules = [
  { value: 20, color: '#007f00' },
  { value: 60, color: '#ff7f00' },
  { value: 80, color: '#7f0000' }
]

function getColorByRule(val) {
  let index = rules.findIndex((item) => val / dataMax < item.value / 100) // 找第一个
  if (index === 0) {
    return baseRule[0].color
  } else if (index === -1) {
    return rules[rules.length - 1].color
  } else {
    return rules[index - 1].color
  }
}
var seriesData = data.map((item) => {
  return {
    value: item,
    itemStyle: {
      color: getColorByRule(item),
      opacity: 0.6,
      barBorderRadius: [5, 5, 5, 5]
    }
  }
})

option = {
  xAxis: [
    {
      type: 'category',
      data: xData,
      axisLine: {
        show: false
      }
    },
    {
      type: 'category',
      position: 'top', // 顶部 X 轴，用于显示标签
      data: data,
      axisLine: { show: false }, // 隐藏轴线
      axisTick: { show: false }, // 隐藏刻度线
      axisLabel: {
        show: true,
        interval: 0,
        formatter: function (value, index) {
          // 根据索引返回对应柱子的数值作为标签
          return value + 'GB'
        },
        fontSize: 16,
        color: function (value) {
          return getColorByRule(value)
        }
      }
    }
  ],
  yAxis: {
    type: 'value',
    min: dataMin,
    max: dataMax,
    show: false
  },
  series: [
    {
      data: seriesData,
      type: 'bar',
      barCategoryGap: 10,
      showBackground: true,
      backgroundStyle: {
        color: 'rgba(180, 180, 180, 0.2)'
      }
    }
  ]
}
```

- No.2

```js
var xData = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
var data = [10, 20, 50, 60, 70, 80, 90]
var [dataMin, dataMax] = [0, 100]
var baseRule = [{ value: 0, color: '#06b0eeff' }]
var rules = [
  { value: 20, color: '#007f00' }, // 百分比
  { value: 60, color: '#ff7f00' },
  { value: 80, color: '#7f0000' }
]

function getColorByRule(val) {
  let index = rules.findIndex((item) => val / dataMax < item.value / 100) // 找第一个
  if (index === 0) {
    return baseRule[0].color
  } else if (index === -1) {
    return rules[rules.length - 1].color
  } else {
    return rules[index - 1].color
  }
}
function getGradientColorByRule(val) {
  let stopList = []
  stopList.push({ offset: 0, color: baseRule[0].color })
  let stopIndex = rules.findIndex((item, index) => {
    if (val / dataMax >= item.value / 100) {
      if (index === rules.length - 1) {
        return true
      } else if (val / dataMax < rules[index + 1].value / 100) {
        return true
      }
    }
  })
  if (stopIndex !== -1) {
    for (let i = 0; i <= stopIndex; i++) {
      stopList.push({
        offset: ((rules[i].value / 100) * dataMax) / val,
        color: rules[i].color
      })
    }
    stopList.push({
      offset: 1,
      color: rules[stopIndex].color
    })
  } else {
    stopList.push({
      offset: 1,
      color: baseRule[0].color
    })
  }
  // 线性渐变，前四个参数分别是 x0, y0, x2, y2, 范围从 0 - 1，相当于在图形包围盒中的百分比
  return new echarts.graphic.LinearGradient(0, 1, 0, 0, stopList)
}
var seriesData = data.map((item) => {
  return {
    value: item,
    itemStyle: {
      color: getGradientColorByRule(item),
      opacity: 0.6,
      barBorderRadius: [5, 5, 5, 5]
    }
  }
})

option = {
  xAxis: [
    {
      type: 'category',
      data: xData,
      axisLine: {
        show: false
      }
    },
    {
      type: 'category',
      position: 'top', // 顶部 X 轴，用于显示标签
      data: data,
      axisLine: { show: false }, // 隐藏轴线
      axisTick: { show: false }, // 隐藏刻度线
      axisLabel: {
        show: true,
        formatter: function (value, index) {
          return value + 'GB'
        },
        fontSize: 16,
        color: function (value) {
          return getColorByRule(value)
        },
        interval: 0
      }
    }
  ],
  yAxis: {
    type: 'value',
    min: dataMin,
    max: dataMax,
    show: false
  },
  series: [
    {
      data: seriesData,
      type: 'bar',
      barCategoryGap: 10,
      showBackground: true,
      backgroundStyle: {
        color: 'rgba(180, 180, 180, 0.2)'
      }
    }
  ]
}
```
